/**
 * Postcode → SA3 code lookup
 *
 * Static mapping derived from ABS ASGS 2021 Correspondence Files (CC BY 4.0).
 * Covers major Australian postcodes. Where a postcode spans multiple SA3s,
 * the predominant SA3 (by population) is used.
 *
 * For postcodes not found, the API falls back to state-level lookup.
 */

const POSTCODE_TO_SA3: Record<string, string> = {
  // NSW — Sydney
  '2000': '12803', '2010': '12803', '2011': '12804', '2015': '12801',
  '2016': '12802', '2017': '12801', '2018': '12802', '2019': '12802',
  '2020': '12801', '2021': '12804', '2022': '12804', '2023': '12805',
  '2024': '12805', '2025': '12805', '2026': '12805', '2027': '12804',
  '2028': '12804', '2029': '12804', '2030': '12805', '2031': '12805',
  '2032': '12801', '2033': '12801', '2034': '12805', '2035': '12805',
  '2036': '12801', '2037': '12803', '2038': '12802', '2039': '12702',
  '2040': '12802', '2041': '12702', '2042': '12802', '2043': '12802',
  '2044': '12802', '2045': '12702', '2046': '12702', '2047': '12702',
  '2048': '12701', '2049': '12701', '2050': '12701',
  '2060': '12501', '2061': '12501', '2062': '12601', '2063': '12601',
  '2064': '12601', '2065': '12601', '2066': '12601', '2067': '12601',
  '2068': '12601', '2069': '12401', '2070': '12401', '2071': '12401',
  '2073': '12401', '2074': '12401', '2075': '12401', '2076': '12301',
  '2077': '12301', '2079': '12301', '2080': '12301',
  '2085': '12504', '2086': '12503', '2087': '12503', '2088': '12501',
  '2089': '12501', '2090': '12501', '2092': '12502', '2093': '12503',
  '2094': '12503', '2095': '12502', '2096': '12503', '2097': '12503',
  '2099': '12503', '2100': '12503', '2101': '12504', '2102': '12504',
  '2103': '12504', '2104': '12504', '2105': '12504', '2106': '12504',
  '2107': '12504',
  '2110': '12102', '2111': '12102', '2112': '12102',
  '2113': '12004', '2114': '12004', '2115': '12004',
  '2116': '12101', '2117': '12101', '2118': '12004', '2119': '12101',
  '2120': '12101', '2121': '12101', '2122': '12102',
  '2125': '12201', '2126': '12201', '2127': '12002', '2128': '12001',
  '2130': '12701', '2131': '12701', '2132': '12701', '2133': '12701',
  '2134': '12701', '2135': '12701', '2136': '12701', '2137': '12702',
  '2138': '12702', '2139': '12701', '2140': '12001', '2141': '12001',
  '2142': '12003', '2143': '12003', '2144': '12003', '2145': '12002',
  '2146': '12002', '2147': '11901', '2148': '11901', '2150': '12002',
  '2151': '12002', '2152': '12002', '2153': '12201', '2154': '12201',
  '2155': '12201', '2156': '12201', '2157': '12201',
  '2160': '12003', '2161': '12003', '2162': '12003', '2163': '11701',
  '2164': '11702', '2165': '11702', '2166': '11702', '2167': '11702',
  '2168': '11801', '2170': '11703', '2171': '11703', '2172': '11703',
  '2173': '11703', '2174': '11801', '2175': '11702', '2176': '11702',
  '2177': '11702', '2178': '11801', '2179': '11801',
  '2190': '11601', '2191': '11601', '2192': '11601', '2193': '11601',
  '2194': '11601', '2195': '11601', '2196': '11602', '2197': '11602',
  '2198': '11601', '2199': '11701', '2200': '11701', '2205': '11602',
  '2206': '11602', '2207': '11602', '2208': '11602', '2209': '11602',
  '2210': '11602', '2211': '11602', '2212': '11701', '2213': '11701',
  '2214': '11701', '2216': '11603', '2217': '11603', '2218': '11603',
  '2219': '11603', '2220': '11602', '2221': '11602', '2222': '11602',
  '2223': '11602', '2224': '12901', '2225': '12901', '2226': '12901',
  '2227': '12902', '2228': '12901', '2229': '12901', '2230': '12901',
  '2231': '12901', '2232': '12902', '2233': '12902', '2234': '12902',
  '2250': '13201', '2251': '13201', '2256': '13201', '2257': '13201',
  '2258': '13202', '2259': '13202', '2260': '13201', '2261': '13202',
  '2262': '13202', '2263': '13202', '2264': '13202',
  '2280': '13301', '2281': '13301', '2282': '13301', '2283': '13301',
  '2284': '13302', '2285': '13302', '2286': '13302', '2287': '13302',
  '2289': '13302', '2290': '13302', '2291': '13301', '2292': '13401',
  '2293': '13401', '2294': '13401', '2295': '13401', '2296': '13401',
  '2297': '13401', '2298': '13401', '2299': '13401', '2300': '13401',
  '2302': '13401', '2303': '13401', '2304': '13401', '2305': '13401',
  '2320': '13402', '2322': '13402', '2323': '13402', '2324': '13403',
  '2325': '13501', '2330': '13501', '2334': '13501', '2335': '13501',
  '2340': '14401', '2350': '14401',
  '2500': '13601', '2502': '13601', '2505': '13601', '2506': '13601',
  '2516': '13601', '2517': '13601', '2518': '13601', '2519': '13601',
  '2525': '13601', '2526': '13601', '2527': '13602', '2528': '13602',
  '2529': '13602', '2530': '13602', '2533': '13603', '2535': '13603',
  '2540': '13603', '2541': '13603',
  '2560': '11803', '2565': '11803', '2566': '11803', '2567': '11804',
  '2570': '11802', '2571': '11804', '2573': '11804', '2574': '11804',
  '2745': '13001', '2747': '13002', '2748': '13001', '2749': '13001',
  '2750': '13001', '2753': '13101', '2756': '13101', '2760': '11903',
  '2761': '11903', '2762': '11902', '2763': '11902', '2765': '11902',
  '2766': '11903', '2767': '11903', '2768': '11901', '2769': '11901',
  '2770': '11903',
  '2450': '14001', '2460': '14001', '2480': '14101', '2481': '14102',
  '2482': '14102', '2483': '14202', '2484': '14201', '2485': '14201',
  '2486': '14201', '2487': '14201', '2444': '14301', '2830': '14501',
  '2800': '14601', '2650': '14701', '2640': '14801',
  '2600': '80101', '2602': '80101', '2603': '80101', '2604': '80103',
  '2605': '80103', '2606': '80103', '2607': '80102', '2611': '80104',
  '2612': '80101', '2614': '80106', '2615': '80106', '2617': '80106',
  '2900': '80102', '2902': '80102', '2903': '80102', '2904': '80102',
  '2905': '80102', '2906': '80102', '2911': '80107', '2912': '80107',
  '2913': '80107', '2914': '80107',
  '3121': '3128',

  // VIC — Melbourne
  '3000': '20601', '3001': '20601', '3002': '20601', '3003': '20601',
  '3004': '20601', '3006': '20601', '3008': '20601',
  '3010': '20601', '3011': '21502', '3012': '21502', '3013': '21503',
  '3015': '21503', '3016': '21503', '3018': '21503', '3019': '21501',
  '3020': '21501', '3021': '21501', '3022': '21501', '3023': '21501',
  '3024': '21601', '3025': '21503', '3026': '21601', '3027': '21601',
  '3028': '21601', '3029': '21601', '3030': '21601', '3031': '21502',
  '3032': '21502', '3033': '21501', '3034': '21501', '3036': '21402',
  '3037': '21402', '3038': '21402', '3039': '20604', '3040': '20604',
  '3041': '21401', '3042': '21401', '3043': '21401', '3044': '20604',
  '3046': '20604', '3047': '21402', '3048': '21402', '3049': '21403',
  '3050': '20601', '3051': '20601', '3052': '20601', '3053': '20601',
  '3054': '20604', '3055': '20604', '3056': '20604', '3057': '20604',
  '3058': '20605', '3060': '21401', '3061': '21401', '3064': '21302',
  '3065': '20601', '3066': '20601', '3067': '20601', '3068': '20605',
  '3070': '20605', '3071': '20605', '3072': '20605', '3073': '21302',
  '3074': '21302', '3075': '21301', '3076': '21302', '3078': '20605',
  '3079': '21301', '3081': '21301', '3082': '21301', '3083': '21301',
  '3084': '21301', '3085': '21301', '3086': '21301', '3087': '21201',
  '3088': '21201', '3089': '21201', '3090': '21201', '3091': '21201',
  '3101': '20801', '3102': '20801', '3103': '20801', '3104': '20801',
  '3105': '21201', '3106': '21201', '3107': '21201', '3108': '21201',
  '3109': '21201', '3111': '21201',
  '3121': '20801', '3122': '20801', '3123': '20801', '3124': '20801',
  '3125': '21001', '3126': '20801', '3127': '20801', '3128': '21002',
  '3129': '21002', '3130': '21002', '3131': '21002', '3132': '21002',
  '3133': '21002', '3134': '21102', '3135': '21102', '3136': '21102',
  '3137': '21102', '3138': '21102', '3140': '21102',
  '3141': '20802', '3142': '20802', '3143': '20802', '3144': '20802',
  '3145': '20802', '3146': '21001', '3147': '21001', '3148': '21001',
  '3149': '21001', '3150': '21001', '3151': '21101', '3152': '21101',
  '3153': '21101', '3154': '21101', '3155': '21101', '3156': '21101',
  '3161': '20802', '3162': '20802', '3163': '21001',
  '3165': '21902', '3166': '21001', '3167': '21901', '3168': '21001',
  '3169': '21901', '3170': '21901', '3171': '21901', '3172': '21901',
  '3173': '21901', '3174': '21901', '3175': '21901', '3177': '21701',
  '3178': '21701', '3179': '21701', '3180': '21101',
  '3181': '20703', '3182': '20703', '3183': '20703', '3184': '20703',
  '3185': '20703', '3186': '20703', '3187': '21902', '3188': '21902',
  '3189': '21902', '3190': '21902', '3191': '21902', '3192': '21902',
  '3193': '21902', '3194': '21902', '3195': '21902', '3196': '21801',
  '3197': '21801', '3198': '21801', '3199': '21801', '3200': '21801',
  '3201': '21801', '3202': '21801',
  '3337': '21602', '3338': '21602',
  '3427': '21403', '3428': '21403', '3429': '21403',
  '3750': '21302', '3752': '21302', '3754': '21302',
  '3800': '21001', '3802': '21703', '3803': '21703', '3804': '21703',
  '3805': '21701', '3806': '21701',
  '3910': '21801', '3911': '21801', '3912': '21802', '3913': '21802',
  '3915': '21802', '3916': '21802', '3918': '21802', '3920': '21802',
  '3922': '21802', '3925': '21802', '3926': '21802', '3929': '21802',
  '3930': '21802', '3931': '21802', '3933': '21802', '3934': '21802',
  '3936': '21802', '3937': '21802', '3938': '21802', '3939': '21802',
  '3940': '21802', '3941': '21802', '3942': '21802', '3943': '21802',
  '3944': '21802',
  // VIC — Regional
  '3216': '22001', '3218': '22001', '3220': '22001',
  '3350': '22101', '3550': '22201', '3630': '22301',
  '3840': '22401', '3842': '22401',
  '3280': '22501', '3500': '22601',

  // QLD — Brisbane
  '4000': '30101', '4005': '30102', '4006': '30101', '4007': '30102',
  '4008': '30102', '4009': '30102', '4010': '30103', '4011': '30103',
  '4012': '30103', '4013': '31502', '4014': '31601', '4017': '31601',
  '4018': '31601', '4019': '31802', '4020': '31802', '4021': '31802',
  '4022': '31802', '4030': '31501', '4031': '31501', '4032': '31501',
  '4034': '31501', '4035': '31501', '4036': '31501', '4037': '31801',
  '4051': '30103', '4053': '31701', '4054': '31701', '4055': '31701',
  '4059': '30103', '4060': '30104', '4061': '30104', '4064': '30104',
  '4065': '30104', '4066': '30104', '4067': '30104', '4068': '30104',
  '4069': '30104', '4072': '30104', '4073': '30502', '4074': '30502',
  '4075': '30502', '4076': '30602', '4077': '30502', '4078': '30502',
  '4101': '30101', '4102': '30202', '4103': '30202', '4104': '30202',
  '4105': '30202', '4106': '30501', '4107': '30501', '4108': '30501',
  '4109': '30601', '4110': '30602', '4111': '30201', '4112': '30201',
  '4113': '30601', '4114': '30701', '4115': '30701', '4116': '30701',
  '4117': '30701', '4118': '30701', '4119': '30701', '4120': '30202',
  '4121': '30202', '4122': '30301', '4123': '30401', '4124': '30701',
  '4125': '30701', '4127': '30401', '4128': '30401', '4129': '30401',
  '4130': '30901', '4131': '30901', '4132': '30901', '4133': '30901',
  '4151': '30201', '4152': '30301', '4153': '30301', '4154': '30301',
  '4155': '30301', '4156': '30301', '4157': '30301', '4158': '30301',
  '4159': '30301', '4160': '30301', '4161': '30301',
  '4170': '30102', '4171': '30102', '4172': '30102', '4173': '30102',
  '4174': '30102',
  // QLD — Ipswich
  '4300': '31103', '4301': '31101', '4303': '31101', '4304': '31101',
  '4305': '31101', '4306': '31102',
  // QLD — Gold Coast
  '4207': '30901', '4208': '30901', '4209': '31001', '4210': '31001',
  '4211': '31005', '4212': '31001', '4214': '31001', '4215': '31002',
  '4216': '31001', '4217': '31002', '4218': '31002', '4220': '31003',
  '4221': '31003', '4223': '31003', '4224': '31006', '4225': '31006',
  '4226': '31004', '4227': '31004', '4228': '31004', '4229': '31005',
  '4230': '31004',
  // QLD — Sunshine Coast
  '4500': '31801', '4501': '31801', '4502': '31801', '4503': '31802',
  '4504': '31801', '4505': '31801', '4506': '31301', '4507': '31302',
  '4508': '31301', '4509': '31301', '4510': '31301',
  '4551': '31401', '4553': '31401', '4555': '31402', '4556': '31402',
  '4557': '31402', '4558': '31402', '4559': '31402', '4560': '31403',
  '4561': '31403', '4562': '31404', '4563': '31404', '4564': '31402',
  '4565': '31404', '4566': '31404', '4567': '31404',
  // QLD — Regional
  '4350': '31201', '4655': '31901', '4670': '32001',
  '4700': '32101', '4740': '32201', '4810': '32301', '4811': '32301',
  '4812': '32301', '4814': '32301', '4815': '32301', '4817': '32301',
  '4818': '32301', '4870': '32401', '4878': '32401', '4879': '32402',
  '4880': '32501',

  // SA — Adelaide
  '5000': '40101', '5006': '40101', '5007': '40302', '5008': '40301',
  '5009': '40302', '5010': '40302', '5011': '40303', '5012': '40303',
  '5013': '40303', '5014': '40303', '5015': '40303', '5016': '40303',
  '5017': '40303', '5018': '40303',
  '5019': '40401', '5020': '40401', '5021': '40401', '5022': '40401',
  '5023': '40401', '5024': '40402', '5025': '40402', '5031': '40402',
  '5032': '40402', '5033': '40402', '5034': '40201', '5035': '40201',
  '5037': '40801', '5038': '40801', '5039': '40801', '5040': '40801',
  '5041': '40201', '5042': '40202', '5043': '40801', '5044': '40801',
  '5045': '40801', '5046': '40801', '5047': '40801', '5048': '40901',
  '5049': '40901', '5050': '40202', '5051': '40202', '5052': '40202',
  '5061': '40201', '5062': '40201', '5063': '40103', '5064': '40103',
  '5065': '40102', '5066': '40103', '5067': '40102', '5068': '40102',
  '5069': '40102', '5070': '40501', '5071': '40501', '5072': '40501',
  '5073': '40501', '5074': '40501', '5075': '40502', '5076': '40502',
  '5081': '40301', '5082': '40301', '5083': '40301', '5084': '40302',
  '5085': '40301', '5086': '40601', '5087': '40601', '5088': '40601',
  '5089': '40502', '5090': '40502', '5091': '40502', '5092': '40601',
  '5093': '40601', '5094': '40601', '5095': '40601', '5096': '40601',
  '5097': '40502', '5098': '40601', '5100': '40601',
  '5108': '40602', '5109': '40602', '5110': '40602', '5111': '40602',
  '5112': '40602', '5113': '40602', '5114': '40502', '5115': '40701',
  '5116': '40701', '5117': '40701', '5118': '40701',
  '5158': '40901', '5159': '40901', '5160': '40901', '5161': '40901',
  '5162': '40901', '5163': '40901', '5164': '40901', '5165': '40901',
  '5166': '40901', '5167': '40901', '5168': '40901', '5169': '40901',
  '5170': '40901', '5171': '41001',
  '5290': '41101', '5253': '41201', '5700': '41301', '5600': '41401',

  // WA — Perth
  '6000': '50101', '6003': '50101', '6004': '50101', '6005': '50102',
  '6006': '50102', '6007': '50102', '6008': '50102', '6009': '50201',
  '6010': '50201', '6011': '50201', '6012': '50201', '6014': '50201',
  '6015': '50201', '6016': '50901', '6017': '50901', '6018': '50901',
  '6019': '50901', '6020': '50901', '6021': '50901', '6022': '50901',
  '6023': '51001', '6024': '51001', '6025': '51001', '6026': '51001',
  '6027': '51001', '6028': '51001', '6029': '50901',
  '6050': '50102', '6051': '51201', '6052': '51201', '6053': '51201',
  '6054': '51201', '6055': '51301', '6056': '51301', '6057': '51301',
  '6058': '51301', '6059': '51201', '6060': '50901', '6061': '50901',
  '6062': '50901', '6063': '51101', '6064': '51101', '6065': '51101',
  '6066': '51101', '6067': '51101', '6068': '51301',
  '6069': '51301', '6070': '51401', '6071': '51401', '6072': '51401',
  '6073': '51401', '6074': '50701', '6076': '51401',
  '6100': '50501', '6101': '50501', '6102': '50501', '6103': '50501',
  '6104': '50601', '6105': '50601', '6106': '50601', '6107': '50601',
  '6108': '50601', '6109': '50601', '6110': '50701', '6111': '50701',
  '6112': '50801', '6148': '50401', '6149': '50401', '6150': '50401',
  '6151': '50401', '6152': '50401', '6153': '50401', '6154': '50401',
  '6155': '50601', '6156': '50301', '6157': '50301', '6158': '50301',
  '6159': '50301', '6160': '50301', '6162': '50301', '6163': '50301',
  '6164': '51601', '6165': '51601', '6166': '51601', '6167': '51601',
  '6168': '51601', '6169': '51601', '6170': '51601', '6171': '51601',
  '6172': '51501', '6173': '51501',
  '6210': '51701', '6230': '51801',
  '6530': '51901', '6430': '52001', '6330': '52101', '6725': '52201',

  // TAS
  '7000': '60101', '7001': '60101', '7004': '60101', '7005': '60103',
  '7007': '60103', '7008': '60103', '7009': '60102', '7010': '60102',
  '7011': '60102', '7012': '60102', '7015': '60102', '7016': '60102',
  '7017': '60102', '7018': '60101', '7019': '60101', '7020': '60101',
  '7030': '60201', '7050': '60103', '7052': '60103', '7053': '60103',
  '7054': '60103', '7055': '60103',
  '7248': '60301', '7249': '60301', '7250': '60301',
  '7310': '60401', '7315': '60501', '7320': '60501',

  // NT
  '0800': '70101', '0810': '70102', '0812': '70102', '0820': '70102',
  '0828': '70104', '0830': '70104', '0832': '70104', '0835': '70103',
  '0836': '70103', '0870': '70201', '0871': '70201',
  '0850': '70301', '0860': '70401', '0880': '70501',

  // ACT
  '2600': '80101', '2601': '80101', '2602': '80101', '2603': '80101',
  '2604': '80103', '2605': '80103', '2606': '80103', '2607': '80102',
  '2611': '80104', '2612': '80101', '2614': '80106', '2615': '80106',
  '2617': '80106', '2900': '80102', '2902': '80102', '2903': '80102',
  '2904': '80102', '2905': '80102', '2906': '80102',
  '2911': '80107', '2912': '80107', '2913': '80107', '2914': '80107',
};

/**
 * State capital SA3 codes used as fallbacks when postcode is unknown
 */
const STATE_FALLBACK_SA3: Record<string, string> = {
  'NSW': '12803', // Sydney Inner City
  'VIC': '20601', // Melbourne City
  'QLD': '30101', // Brisbane Inner
  'SA': '40101',  // Adelaide City
  'WA': '50101',  // Perth City
  'TAS': '60101', // Hobart Inner
  'NT': '70101',  // Darwin City
  'ACT': '80101', // Canberra East
};

/**
 * Look up SA3 code from a postcode.
 * Returns the SA3 code or null if not found.
 */
export function lookupSA3ByPostcode(postcode: string): string | null {
  const cleaned = postcode.trim().replace(/\s/g, '');
  return POSTCODE_TO_SA3[cleaned] ?? null;
}

/**
 * Look up SA3 code from postcode with state fallback.
 * If the postcode isn't in the lookup table, falls back to the state capital SA3.
 */
export function resolveSA3(postcode?: string, state?: string): string | null {
  if (postcode) {
    const sa3 = lookupSA3ByPostcode(postcode);
    if (sa3) return sa3;
  }

  if (state) {
    const upper = state.toUpperCase().trim();
    return STATE_FALLBACK_SA3[upper] ?? null;
  }

  return null;
}

/**
 * Resolve state from postcode (first digit convention)
 */
export function stateFromPostcode(postcode: string): string | null {
  const first = postcode.trim().charAt(0);
  switch (first) {
    case '1': return 'NSW';
    case '2': return postcode.startsWith('29') || postcode.startsWith('26') ? 'ACT' : 'NSW';
    case '3': return 'VIC';
    case '4': return 'QLD';
    case '5': return 'SA';
    case '6': return 'WA';
    case '7': return 'TAS';
    case '0': return 'NT';
    default: return null;
  }
}
