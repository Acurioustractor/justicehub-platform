"use strict";(()=>{var e={};e.id=5921,e.ids=[5921],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},85379:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>q,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var r={};s.r(r),s.d(r,{DELETE:()=>x,POST:()=>v});var i=s(49303),o=s(88716),n=s(60670),a=s(87070),u=s(54674),p=s(89773),d=s(57745),c=s(75571),l=s(95456);async function v(e,{params:t}){try{let s=await (0,c.getServerSession)(l.L);if(!s?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.id,{notes:i}=await e.json();if((await u.db.select().from(p.savedOpportunities).where((0,d.xD)((0,d.eq)(p.savedOpportunities.opportunityId,r),(0,d.eq)(p.savedOpportunities.userId,s.user.id))).limit(1)).length>0)return void 0!==i&&await u.db.update(p.savedOpportunities).set({notes:i}).where((0,d.xD)((0,d.eq)(p.savedOpportunities.opportunityId,r),(0,d.eq)(p.savedOpportunities.userId,s.user.id))),a.NextResponse.json({message:"Opportunity already saved",saved:!0});return await u.db.insert(p.savedOpportunities).values({opportunityId:r,userId:s.user.id,notes:i}),a.NextResponse.json({message:"Opportunity saved successfully",saved:!0})}catch(e){return a.NextResponse.json({error:"Failed to save opportunity"},{status:500})}}async function x(e,{params:t}){try{let e=await (0,c.getServerSession)(l.L);if(!e?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.id;return await u.db.delete(p.savedOpportunities).where((0,d.xD)((0,d.eq)(p.savedOpportunities.opportunityId,s),(0,d.eq)(p.savedOpportunities.userId,e.user.id))),a.NextResponse.json({message:"Opportunity unsaved successfully",saved:!1})}catch(e){return a.NextResponse.json({error:"Failed to unsave opportunity"},{status:500})}}let q=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/opportunities/[id]/save/route",pathname:"/api/opportunities/[id]/save",filename:"route",bundlePath:"app/api/opportunities/[id]/save/route"},resolvedPagePath:"/Users/benknight/Code/JusticeHub/src/app/api/opportunities/[id]/save/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:h,serverHooks:g}=q,m="/api/opportunities/[id]/save/route";function f(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},95456:(e,t,s)=>{s.d(t,{L:()=>u});var r=s(54674),i=s(89773),o=s(57745),n=s(75571),a=s.n(n);let u={providers:[(0,s(21474).Z)({clientId:process.env.AUTH0_CLIENT_ID||"",clientSecret:process.env.AUTH0_CLIENT_SECRET||"",issuer:process.env.AUTH0_ISSUER_BASE_URL||""})],session:{strategy:"jwt"},callbacks:{async jwt({token:e,user:t,account:s}){if(s&&t){e.accessToken=s.access_token;let n=t.id,a=await r.db.query.users.findFirst({where:(0,o.eq)(i.users.auth0Id,n)});if(!a){let[e]=await r.db.insert(i.users).values({auth0Id:n,email:t.email,name:t.name,role:"youth"}).returning();a=e}e.id=a.id,e.role=a.role}return e},session:async({session:e,token:t})=>(e.accessToken=t.accessToken,e.user&&(e.user.id=t.id,e.user.role=t.role),e)},secret:process.env.NEXTAUTH_SECRET};a()(u)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972,2707,8384,6546,4674],()=>s(85379));module.exports=r})();