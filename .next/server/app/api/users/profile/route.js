"use strict";(()=>{var e={};e.id=2807,e.ids=[2807],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},22037:e=>{e.exports=require("os")},63477:e=>{e.exports=require("querystring")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},78579:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>U,requestAsyncStorage:()=>x,routeModule:()=>h,serverHooks:()=>E,staticGenerationAsyncStorage:()=>A});var s={};t.r(s),t.d(s,{GET:()=>c,PATCH:()=>f});var o=t(49303),i=t(88716),n=t(60670),a=t(87070),u=t(79396),p=t(54674),d=t(89773),l=t(57745);async function c(e){try{let e=await (0,u.Gg)();if(!e?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=e.user.sub,t=await p.db.query.users.findFirst({where:(0,l.eq)(d.users.auth0Id,r),with:{organization:!0,youthProfile:!0,mentor:!0}});if(!t){let[s]=await p.db.insert(d.users).values({auth0Id:r,email:e.user.email,role:"youth",profile:{name:e.user.name||"",picture:e.user.picture||""},privacySettings:{shareStories:!0,allowMentorContact:!0,showProfile:!0}}).returning();s&&(await p.db.insert(d.youthProfiles).values({userId:s.id,demographics:{},journeyTimeline:[],skillsInterests:[],achievements:[],privacyControls:{}}),t=await p.db.query.users.findFirst({where:(0,l.eq)(d.users.id,s.id),with:{organization:!0,youthProfile:!0,mentor:!0}}))}return t&&await p.db.update(d.users).set({updatedAt:new Date,profile:{...t.profile,lastLogin:new Date().toISOString()}}).where((0,l.eq)(d.users.id,t.id)),a.NextResponse.json({id:t?.id,email:t?.email,role:t?.role,profile:t?.profile,organization:t?.organization,youthProfile:t?.youthProfile,mentor:t?.mentor,createdAt:t?.createdAt,updatedAt:t?.updatedAt})}catch(e){return a.NextResponse.json({error:"Failed to fetch profile"},{status:500})}}async function f(e){try{let r=await (0,u.Gg)();if(!r?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let t=r.user.sub,s=await e.json(),o=await p.db.query.users.findFirst({where:(0,l.eq)(d.users.auth0Id,t)});if(!o)return a.NextResponse.json({error:"User not found"},{status:404});let i={};s.profile&&(i.profile={...o.profile,...s.profile}),s.privacySettings&&(i.privacySettings={...o.privacySettings,...s.privacySettings}),i.updatedAt=new Date;let[n]=await p.db.update(d.users).set(i).where((0,l.eq)(d.users.id,o.id)).returning();return s.youthProfile&&"youth"===o.role&&await p.db.update(d.youthProfiles).set({...s.youthProfile,updatedAt:new Date}).where((0,l.eq)(d.youthProfiles.userId,o.id)),s.mentorProfile&&"mentor"===o.role&&await p.db.update(d.mentors).set({...s.mentorProfile,updatedAt:new Date}).where((0,l.eq)(d.mentors.userId,o.id)),a.NextResponse.json({success:!0,user:n})}catch(e){return a.NextResponse.json({error:"Failed to update profile"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/users/profile/route",pathname:"/api/users/profile",filename:"route",bundlePath:"app/api/users/profile/route"},resolvedPagePath:"/Users/benknight/Code/JusticeHub/src/app/api/users/profile/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:A,serverHooks:E}=h,w="/api/users/profile/route";function U(){return(0,n.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:A})}},79396:(e,r,t)=>{t.d(r,{Gg:()=>l});var s=t(64099);if(!process.env.AUTH0_SECRET)throw Error("AUTH0_SECRET is not defined");if(!process.env.AUTH0_BASE_URL)throw Error("AUTH0_BASE_URL is not defined");if(!process.env.AUTH0_ISSUER_BASE_URL)throw Error("AUTH0_ISSUER_BASE_URL is not defined");if(!process.env.AUTH0_CLIENT_ID)throw Error("AUTH0_CLIENT_ID is not defined");if(!process.env.AUTH0_CLIENT_SECRET)throw Error("AUTH0_CLIENT_SECRET is not defined");let{handleAuth:o,handleLogin:i,handleLogout:n,handleCallback:a,handleProfile:u,withApiAuthRequired:p,withPageAuthRequired:d,getSession:l,getAccessToken:c,updateSession:f}=(0,s.initAuth0)({baseURL:process.env.AUTH0_BASE_URL,issuerBaseURL:process.env.AUTH0_ISSUER_BASE_URL,clientID:process.env.AUTH0_CLIENT_ID,clientSecret:process.env.AUTH0_CLIENT_SECRET,secret:process.env.AUTH0_SECRET,authorizationParams:{scope:process.env.AUTH0_SCOPE||"openid profile email",audience:process.env.AUTH0_AUDIENCE},routes:{callback:"/api/auth/callback",postLogoutRedirect:"/"},session:{rollingDuration:28800,absoluteDuration:604800}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972,2707,8384,4099,4674],()=>t(78579));module.exports=s})();