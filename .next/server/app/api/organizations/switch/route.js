"use strict";(()=>{var e={};e.id=4068,e.ids=[4068],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},22037:e=>{e.exports=require("os")},63477:e=>{e.exports=require("querystring")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},24131:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>z,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var i={};r.r(i),r.d(i,{POST:()=>p});var n=r(49303),s=r(88716),o=r(60670),a=r(87070),d=r(64099),u=r(54674),c=r(89773),l=r(14309),g=r(57745),f=r(9576);async function p(e){try{let t=await (0,d.getSession)(e,new a.NextResponse);if(!t?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{organizationId:r}=await e.json();if(!r)return a.NextResponse.json({error:"Organization ID is required"},{status:400});let[i]=await u.db.select().from(c.users).where((0,g.eq)(c.users.auth0Id,t.user.sub)).limit(1);if(!i)return a.NextResponse.json({error:"User not found"},{status:404});let[n]=await u.db.select().from(l.Rp).where((0,g.xD)((0,g.eq)(l.Rp.userId,i.id),(0,g.eq)(l.Rp.organizationId,r),(0,g.eq)(l.Rp.isActive,!0))).limit(1);if(!n)return a.NextResponse.json({error:"You are not a member of this organization"},{status:403});return await u.db.update(c.users).set({currentOrganizationId:r,updatedAt:new Date}).where((0,g.eq)(c.users.id,i.id)),await u.db.insert(l.yV).values({id:(0,f.Z)(),organizationId:r,userId:i.id,action:"organization_switched",details:{previousOrganizationId:i.currentOrganizationId},createdAt:new Date}),a.NextResponse.json({success:!0,organizationId:r,role:n.role,permissions:n.permissions})}catch(e){return a.NextResponse.json({error:"Failed to switch organization"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/organizations/switch/route",pathname:"/api/organizations/switch",filename:"route",bundlePath:"app/api/organizations/switch/route"},resolvedPagePath:"/Users/benknight/Code/JusticeHub/src/app/api/organizations/switch/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:x,staticGenerationAsyncStorage:_,serverHooks:h}=m,y="/api/organizations/switch/route";function z(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},9576:(e,t,r)=>{r.d(t,{Z:()=>u});var i=r(6113),n=r.n(i);let s={randomUUID:n().randomUUID},o=new Uint8Array(256),a=o.length,d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));let u=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();let i=(e=e||{}).random||(e.rng||function(){return a>o.length-16&&(n().randomFillSync(o),a=0),o.slice(a,a+=16)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return function(e,t=0){return d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]}(i)}},14309:(e,t,r)=>{r.d(t,{yV:()=>y,Rp:()=>_});var i=r(8324),n=r(72140),s=r(28680),o=r(1575),a=r(98748),d=r(16653),u=r(19326);class c{constructor(e,t){this.unique=e,this.name=t}static [u.Q]="PgIndexBuilderOn";on(...e){return new l(e,this.unique,!1,this.name)}onOnly(...e){return new l(e,this.unique,!0,this.name)}}class l{static [u.Q]="PgIndexBuilder";config;constructor(e,t,r,i){this.config={name:i,columns:e,unique:t,only:r}}concurrently(){return this.config.concurrently=!0,this}using(e){return this.config.using=e,this}asc(){return this.config.order="asc",this}desc(){return this.config.order="desc",this}nullsFirst(){return this.config.nulls="first",this}nullsLast(){return this.config.nulls="last",this}where(e){return this.config.where=e,this}build(e){return new g(this.config,e)}}class g{static [u.Q]="PgIndex";config;constructor(e,t){this.config={...e,table:t}}}function f(e){return new c(!1,e)}var p=r(706),m=r(5312),x=r(81727);let _=(0,i.af)("organization_members",{id:(0,n.fL)("id").primaryKey(),organizationId:(0,n.fL)("organization_id").notNull().references(()=>x.organizations.id,{onDelete:"cascade"}),userId:(0,n.fL)("user_id").notNull().references(()=>m.users.id,{onDelete:"cascade"}),role:(0,n.fL)("role").notNull().$type().default("member"),permissions:(0,s.JB)("permissions"),joinedAt:(0,o.AB)("joined_at").defaultNow().notNull(),invitedAt:(0,o.AB)("invited_at"),invitedBy:(0,n.fL)("invited_by").references(()=>m.users.id),isActive:(0,a.O7)("is_active").default(!0).notNull(),isPrimary:(0,a.O7)("is_primary").default(!1).notNull(),metadata:(0,s.JB)("metadata"),createdAt:(0,o.AB)("created_at").defaultNow().notNull(),updatedAt:(0,o.AB)("updated_at").defaultNow().notNull()},e=>({uniqueMember:(0,d.Tw)().on(e.organizationId,e.userId),userIdx:f("idx_org_member_user").on(e.userId),orgIdx:f("idx_org_member_org").on(e.organizationId),activeIdx:f("idx_org_member_active").on(e.isActive)})),h=(0,i.af)("organization_invitations",{id:(0,n.fL)("id").primaryKey(),organizationId:(0,n.fL)("organization_id").notNull().references(()=>x.organizations.id,{onDelete:"cascade"}),email:(0,n.fL)("email").notNull(),role:(0,n.fL)("role").notNull().$type().default("member"),invitedBy:(0,n.fL)("invited_by").notNull().references(()=>m.users.id),token:(0,n.fL)("token").notNull().unique(),message:(0,n.fL)("message"),expiresAt:(0,o.AB)("expires_at").notNull(),acceptedAt:(0,o.AB)("accepted_at"),acceptedBy:(0,n.fL)("accepted_by").references(()=>m.users.id),rejectedAt:(0,o.AB)("rejected_at"),metadata:(0,s.JB)("metadata"),createdAt:(0,o.AB)("created_at").defaultNow().notNull()},e=>({orgIdx:f("idx_org_invitation_org").on(e.organizationId),emailIdx:f("idx_org_invitation_email").on(e.email),tokenIdx:f("idx_org_invitation_token").on(e.token)})),y=(0,i.af)("organization_activity_log",{id:(0,n.fL)("id").primaryKey(),organizationId:(0,n.fL)("organization_id").notNull().references(()=>x.organizations.id,{onDelete:"cascade"}),userId:(0,n.fL)("user_id").references(()=>m.users.id,{onDelete:"set null"}),action:(0,n.fL)("action").notNull(),targetType:(0,n.fL)("target_type"),targetId:(0,n.fL)("target_id"),details:(0,s.JB)("details"),ipAddress:(0,n.fL)("ip_address"),userAgent:(0,n.fL)("user_agent"),createdAt:(0,o.AB)("created_at").defaultNow().notNull()},e=>({orgIdx:f("idx_org_activity_org").on(e.organizationId),userIdx:f("idx_org_activity_user").on(e.userId),createdIdx:f("idx_org_activity_created").on(e.createdAt)}));(0,p.lE)(_,({one:e})=>({organization:e(x.organizations,{fields:[_.organizationId],references:[x.organizations.id]}),user:e(m.users,{fields:[_.userId],references:[m.users.id]}),invitedByUser:e(m.users,{fields:[_.invitedBy],references:[m.users.id]})})),(0,p.lE)(h,({one:e})=>({organization:e(x.organizations,{fields:[h.organizationId],references:[x.organizations.id]}),invitedByUser:e(m.users,{fields:[h.invitedBy],references:[m.users.id]}),acceptedByUser:e(m.users,{fields:[h.acceptedBy],references:[m.users.id]})})),(0,p.lE)(y,({one:e})=>({organization:e(x.organizations,{fields:[y.organizationId],references:[x.organizations.id]}),user:e(m.users,{fields:[y.userId],references:[m.users.id]})})),(0,p.lE)(x.organizations,({many:e})=>({members:e(_),invitations:e(h),activityLogs:e(y)})),(0,p.lE)(m.users,({many:e})=>({organizationMemberships:e(_),sentInvitations:e(h)}))}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,5972,2707,8384,4099,4674],()=>r(24131));module.exports=i})();