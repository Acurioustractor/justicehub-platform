"use strict";(()=>{var e={};e.id=335,e.ids=[335],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},97596:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>q});var r={};s.r(r),s.d(r,{GET:()=>m,POST:()=>h});var n=s(49303),o=s(88716),i=s(60670),a=s(87070),u=s(54674),c=s(89773),p=s(57745),l=s(75571),d=s(95456);async function h(e,{params:t}){try{let s=await (0,l.getServerSession)(d.L);if(!s?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.id,{message:n,goals:o,meetingFrequency:i,communicationPreference:h}=await e.json(),[m]=await u.db.select().from(c.youthProfiles).where((0,p.eq)(c.youthProfiles.userId,s.user.id)).limit(1);if(!m)return a.NextResponse.json({error:"Youth profile not found. Only youth members can request mentorship."},{status:400});let[x]=await u.db.select().from(c.mentors).where((0,p.xD)((0,p.eq)(c.mentors.id,r),(0,p.eq)(c.mentors.status,"active"),(0,p.eq)(c.mentors.verified,!0))).limit(1);if(!x)return a.NextResponse.json({error:"Mentor not found or not available"},{status:404});if(x.currentMentees>=x.maxMentees)return a.NextResponse.json({error:"Mentor is at full capacity"},{status:400});let f=await u.db.select().from(c.mentorshipRelationships).where((0,p.xD)((0,p.eq)(c.mentorshipRelationships.mentorId,r),(0,p.eq)(c.mentorshipRelationships.youthProfileId,m.id))).limit(1);if(f.length>0){let e=f[0].status;if("active"===e)return a.NextResponse.json({error:"You already have an active mentorship with this mentor"},{status:400});if("pending"===e)return a.NextResponse.json({error:"You already have a pending request with this mentor"},{status:400})}let[q]=await u.db.insert(c.mentorshipRelationships).values({mentorId:r,youthProfileId:m.id,status:"pending",requestMessage:n,goals:o||[],meetingFrequency:i||"Bi-weekly",communicationPreference:h||["video","chat"]}).returning();return a.NextResponse.json({message:"Connection request sent successfully",relationship:q})}catch(e){return a.NextResponse.json({error:"Failed to send connection request"},{status:500})}}async function m(e,{params:t}){try{let e=await (0,l.getServerSession)(d.L);if(!e?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.id,[r]=await u.db.select().from(c.youthProfiles).where((0,p.eq)(c.youthProfiles.userId,e.user.id)).limit(1);if(!r)return a.NextResponse.json({status:"not_youth"});let[n]=await u.db.select().from(c.mentorshipRelationships).where((0,p.xD)((0,p.eq)(c.mentorshipRelationships.mentorId,s),(0,p.eq)(c.mentorshipRelationships.youthProfileId,r.id))).limit(1);if(!n)return a.NextResponse.json({status:"none"});return a.NextResponse.json({status:n.status,relationship:{id:n.id,status:n.status,requestedAt:n.createdAt,startDate:n.startDate,goals:n.goals}})}catch(e){return a.NextResponse.json({error:"Failed to check connection status"},{status:500})}}let x=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/mentors/[id]/connect/route",pathname:"/api/mentors/[id]/connect",filename:"route",bundlePath:"app/api/mentors/[id]/connect/route"},resolvedPagePath:"/Users/benknight/Code/JusticeHub/src/app/api/mentors/[id]/connect/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:q,serverHooks:y}=x,g="/api/mentors/[id]/connect/route";function v(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:q})}},95456:(e,t,s)=>{s.d(t,{L:()=>u});var r=s(54674),n=s(89773),o=s(57745),i=s(75571),a=s.n(i);let u={providers:[(0,s(21474).Z)({clientId:process.env.AUTH0_CLIENT_ID||"",clientSecret:process.env.AUTH0_CLIENT_SECRET||"",issuer:process.env.AUTH0_ISSUER_BASE_URL||""})],session:{strategy:"jwt"},callbacks:{async jwt({token:e,user:t,account:s}){if(s&&t){e.accessToken=s.access_token;let i=t.id,a=await r.db.query.users.findFirst({where:(0,o.eq)(n.users.auth0Id,i)});if(!a){let[e]=await r.db.insert(n.users).values({auth0Id:i,email:t.email,name:t.name,role:"youth"}).returning();a=e}e.id=a.id,e.role=a.role}return e},session:async({session:e,token:t})=>(e.accessToken=t.accessToken,e.user&&(e.user.id=t.id,e.user.role=t.role),e)},secret:process.env.NEXTAUTH_SECRET};a()(u)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,5972,2707,8384,6546,4674],()=>s(97596));module.exports=r})();