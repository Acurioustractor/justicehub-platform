"use strict";(()=>{var e={};e.id=6024,e.ids=[6024],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},51842:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>R,serverHooks:()=>q,staticGenerationAsyncStorage:()=>x});var r={};t.r(r),t.d(r,{GET:()=>m,PATCH:()=>c});var i=t(49303),n=t(88716),o=t(60670),a=t(87070),u=t(54674),p=t(89773),l=t(57745),d=t(75571),h=t(95456);async function m(e,{params:s}){try{let e=await (0,d.getServerSession)(h.L);if(!e?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let t=s.id,[r]=await u.db.select({id:p.mentorshipRelationships.id,status:p.mentorshipRelationships.status,requestedAt:p.mentorshipRelationships.requestedAt,startDate:p.mentorshipRelationships.startDate,endDate:p.mentorshipRelationships.endDate,lastContactDate:p.mentorshipRelationships.lastContactDate,goals:p.mentorshipRelationships.goals,meetingFrequency:p.mentorshipRelationships.meetingFrequency,communicationPreference:p.mentorshipRelationships.communicationPreference,notes:p.mentorshipRelationships.notes,milestones:p.mentorshipRelationships.milestones,mentor:{id:p.mentors.id,userId:p.mentors.userId,name:p.users.name,email:p.users.email,title:p.mentors.title,bio:p.mentors.bio,profileImage:p.mentors.profileImage,expertise:p.mentors.expertise,skills:p.mentors.skills,availability:p.mentors.availability,rating:p.mentors.averageRating,responseTime:p.mentors.responseTime},mentorId:p.mentorshipRelationships.mentorId}).from(p.mentorshipRelationships).innerJoin(p.mentors,(0,l.eq)(p.mentorshipRelationships.mentorId,p.mentors.id)).innerJoin(p.users,(0,l.eq)(p.mentors.userId,p.users.id)).where((0,l.eq)(p.mentorshipRelationships.id,t)).limit(1);if(!r)return a.NextResponse.json({error:"Connection not found"},{status:404});let[i]=await u.db.select({id:p.youthProfiles.id,userId:p.youthProfiles.userId,name:p.users.name,email:p.users.email,bio:p.youthProfiles.bio,interests:p.youthProfiles.interests,goals:p.youthProfiles.goals}).from(p.mentorshipRelationships).innerJoin(p.youthProfiles,(0,l.eq)(p.mentorshipRelationships.youthProfileId,p.youthProfiles.id)).innerJoin(p.users,(0,l.eq)(p.youthProfiles.userId,p.users.id)).where((0,l.eq)(p.mentorshipRelationships.id,t)).limit(1);if(!(e.user.id===r.mentor.userId||e.user.id===i?.userId))return a.NextResponse.json({error:"Unauthorized to view this connection"},{status:403});return a.NextResponse.json({...r,youth:i})}catch(e){return a.NextResponse.json({error:"Failed to fetch connection"},{status:500})}}async function c(e,{params:s}){try{let t=await (0,d.getServerSession)(h.L);if(!t?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=s.id,i=await e.json(),[n]=await u.db.select({mentorUserId:p.users.id}).from(p.mentorshipRelationships).innerJoin(p.mentors,(0,l.eq)(p.mentorshipRelationships.mentorId,p.mentors.id)).innerJoin(p.users,(0,l.eq)(p.mentors.userId,p.users.id)).where((0,l.eq)(p.mentorshipRelationships.id,r)).limit(1),[o]=await u.db.select({youthUserId:p.users.id}).from(p.mentorshipRelationships).innerJoin(p.youthProfiles,(0,l.eq)(p.mentorshipRelationships.youthProfileId,p.youthProfiles.id)).innerJoin(p.users,(0,l.eq)(p.youthProfiles.userId,p.users.id)).where((0,l.eq)(p.mentorshipRelationships.id,r)).limit(1);if(!n||!o)return a.NextResponse.json({error:"Connection not found"},{status:404});if(!(t.user.id===n.mentorUserId||t.user.id===o.youthUserId))return a.NextResponse.json({error:"Unauthorized to update this connection"},{status:403});let[m]=await u.db.update(p.mentorshipRelationships).set({...i,updatedAt:new Date}).where((0,l.eq)(p.mentorshipRelationships.id,r)).returning();return a.NextResponse.json({connection:m,message:"Connection updated successfully"})}catch(e){return a.NextResponse.json({error:"Failed to update connection"},{status:500})}}let R=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/connections/[id]/route",pathname:"/api/connections/[id]",filename:"route",bundlePath:"app/api/connections/[id]/route"},resolvedPagePath:"/Users/benknight/Code/JusticeHub/src/app/api/connections/[id]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:q}=R,y="/api/connections/[id]/route";function g(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:x})}},95456:(e,s,t)=>{t.d(s,{L:()=>u});var r=t(54674),i=t(89773),n=t(57745),o=t(75571),a=t.n(o);let u={providers:[(0,t(21474).Z)({clientId:process.env.AUTH0_CLIENT_ID||"",clientSecret:process.env.AUTH0_CLIENT_SECRET||"",issuer:process.env.AUTH0_ISSUER_BASE_URL||""})],session:{strategy:"jwt"},callbacks:{async jwt({token:e,user:s,account:t}){if(t&&s){e.accessToken=t.access_token;let o=s.id,a=await r.db.query.users.findFirst({where:(0,n.eq)(i.users.auth0Id,o)});if(!a){let[e]=await r.db.insert(i.users).values({auth0Id:o,email:s.email,name:s.name,role:"youth"}).returning();a=e}e.id=a.id,e.role=a.role}return e},session:async({session:e,token:s})=>(e.accessToken=s.accessToken,e.user&&(e.user.id=s.id,e.user.role=s.role),e)},secret:process.env.NEXTAUTH_SECRET};a()(u)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[8948,5972,2707,8384,6546,4674],()=>t(51842));module.exports=r})();