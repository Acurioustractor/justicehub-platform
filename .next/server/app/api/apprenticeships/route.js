"use strict";(()=>{var e={};e.id=7352,e.ids=[7352],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{e.exports=require("pg")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},22037:e=>{e.exports=require("os")},63477:e=>{e.exports=require("querystring")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},31663:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>P,requestAsyncStorage:()=>q,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>g,POST:()=>x});var i=r(49303),o=r(88716),n=r(60670),a=r(87070),u=r(64099),p=r(54674),d=r(89773),l=r(21186),c=r(57745),h=r(81445),f=r(9576);async function g(e){try{let t=await (0,u.getSession)(e,new a.NextResponse);if(!t?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let[r]=await p.db.select().from(d.users).where((0,c.eq)(d.users.auth0Id,t.user.sub)).limit(1);if(!r)return a.NextResponse.json({error:"User not found"},{status:404});let{searchParams:s}=new URL(e.url),i={status:s.get("status")?.split(","),organizationId:s.get("organizationId")||void 0,youthProfileId:s.get("youthProfileId")||void 0},o=p.db.select({apprenticeship:l.apprenticeships,youth:{id:d.youthProfiles.id,firstName:d.users.firstName,lastName:d.users.lastName,email:d.users.email},organization:{id:d.organizations.id,name:d.organizations.name,logo:d.organizations.logo}}).from(l.apprenticeships).leftJoin(d.youthProfiles,(0,c.eq)(l.apprenticeships.youthProfileId,d.youthProfiles.id)).leftJoin(d.users,(0,c.eq)(d.youthProfiles.userId,d.users.id)).leftJoin(d.organizations,(0,c.eq)(l.apprenticeships.organizationId,d.organizations.id));if("youth"===r.role){let[e]=await p.db.select({id:d.youthProfiles.id}).from(d.youthProfiles).where((0,c.eq)(d.youthProfiles.userId,r.id)).limit(1);if(!e)return a.NextResponse.json([]);o=o.where((0,c.eq)(l.apprenticeships.youthProfileId,e.id))}else"org_admin"===r.role&&r.organizationId&&(o=o.where((0,c.eq)(l.apprenticeships.organizationId,r.organizationId)));if(i.status){let e=i.status.map(e=>(0,c.eq)(l.apprenticeships.status,e));o=o.where((0,c.or)(...e))}i.organizationId&&(o=o.where((0,c.eq)(l.apprenticeships.organizationId,i.organizationId))),i.youthProfileId&&(o=o.where((0,c.eq)(l.apprenticeships.youthProfileId,i.youthProfileId)));let n=(await o.orderBy((0,h.C)(l.apprenticeships.createdAt))).map(({apprenticeship:e,youth:t,organization:r})=>({...e,youth:t,organization:r}));return a.NextResponse.json(n)}catch(e){return a.NextResponse.json({error:"Failed to fetch apprenticeships"},{status:500})}}async function x(e){try{let t=await (0,u.getSession)(e,new a.NextResponse);if(!t?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let[r]=await p.db.select().from(d.users).where((0,c.eq)(d.users.auth0Id,t.user.sub)).limit(1);if(!r)return a.NextResponse.json({error:"User not found"},{status:404});if(!["org_admin","platform_admin"].includes(r.role))return a.NextResponse.json({error:"Forbidden"},{status:403});let{youthProfileId:s,organizationId:i,opportunityId:o,contractDetails:n,startDate:h,endDate:g}=await e.json();if(!s||!i||!n||!h)return a.NextResponse.json({error:"Missing required fields"},{status:400});if("org_admin"===r.role&&r.organizationId!==i)return a.NextResponse.json({error:"Forbidden"},{status:403});let[x]=await p.db.select({id:d.youthProfiles.id}).from(d.youthProfiles).where((0,c.eq)(d.youthProfiles.id,s)).limit(1);if(!x)return a.NextResponse.json({error:"Youth profile not found"},{status:404});let m=(0,f.Z)(),[q]=await p.db.insert(l.apprenticeships).values({id:m,youthProfileId:s,organizationId:i,opportunityId:o,status:"pending",contractDetails:n,startDate:new Date(h),endDate:g?new Date(g):null,createdAt:new Date,updatedAt:new Date}).returning();return a.NextResponse.json(q)}catch(e){return a.NextResponse.json({error:"Failed to create apprenticeship"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/apprenticeships/route",pathname:"/api/apprenticeships",filename:"route",bundlePath:"app/api/apprenticeships/route"},resolvedPagePath:"/Users/benknight/Code/JusticeHub/src/app/api/apprenticeships/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:q,staticGenerationAsyncStorage:y,serverHooks:w}=m,I="/api/apprenticeships/route";function P(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}},9576:(e,t,r)=>{r.d(t,{Z:()=>p});var s=r(6113),i=r.n(s);let o={randomUUID:i().randomUUID},n=new Uint8Array(256),a=n.length,u=[];for(let e=0;e<256;++e)u.push((e+256).toString(16).slice(1));let p=function(e,t,r){if(o.randomUUID&&!t&&!e)return o.randomUUID();let s=(e=e||{}).random||(e.rng||function(){return a>n.length-16&&(i().randomFillSync(n),a=0),n.slice(a,a+=16)})();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]}(s)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,2707,8384,4099,4674],()=>r(31663));module.exports=s})();