"use strict";(()=>{var e={};e.id=857,e.ids=[857],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},17718:e=>{e.exports=require("node:child_process")},97742:e=>{e.exports=require("node:process")},22037:e=>{e.exports=require("os")},63477:e=>{e.exports=require("querystring")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},25047:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>m,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>u});var o=r(49303),a=r(88716),n=r(60670),i=r(87070),c=r(79396),l=r(67791);async function u(e){try{let t=await (0,c.Gg)();if(!t?.user)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=e.nextUrl.searchParams.get("organizationId")||void 0,s=(0,l.R)(),o=await s.getStoryMetadata(r),a=i.NextResponse.json(o);return a.headers.set("Cache-Control","public, s-maxage=600, stale-while-revalidate=1200"),a}catch(e){return i.NextResponse.json({error:"Failed to fetch metadata from Airtable"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/airtable/metadata/route",pathname:"/api/airtable/metadata",filename:"route",bundlePath:"app/api/airtable/metadata/route"},resolvedPagePath:"/Users/benknight/Code/JusticeHub/src/app/api/airtable/metadata/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:y}=p,_="/api/airtable/metadata/route";function m(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},79396:(e,t,r)=>{r.d(t,{Gg:()=>p});var s=r(64099);if(!process.env.AUTH0_SECRET)throw Error("AUTH0_SECRET is not defined");if(!process.env.AUTH0_BASE_URL)throw Error("AUTH0_BASE_URL is not defined");if(!process.env.AUTH0_ISSUER_BASE_URL)throw Error("AUTH0_ISSUER_BASE_URL is not defined");if(!process.env.AUTH0_CLIENT_ID)throw Error("AUTH0_CLIENT_ID is not defined");if(!process.env.AUTH0_CLIENT_SECRET)throw Error("AUTH0_CLIENT_SECRET is not defined");let{handleAuth:o,handleLogin:a,handleLogout:n,handleCallback:i,handleProfile:c,withApiAuthRequired:l,withPageAuthRequired:u,getSession:p,getAccessToken:d,updateSession:h}=(0,s.initAuth0)({baseURL:process.env.AUTH0_BASE_URL,issuerBaseURL:process.env.AUTH0_ISSUER_BASE_URL,clientID:process.env.AUTH0_CLIENT_ID,clientSecret:process.env.AUTH0_CLIENT_SECRET,secret:process.env.AUTH0_SECRET,authorizationParams:{scope:process.env.AUTH0_SCOPE||"openid profile email",audience:process.env.AUTH0_AUDIENCE},routes:{callback:"/api/auth/callback",postLogoutRedirect:"/"},session:{rollingDuration:28800,absoluteDuration:604800}})},67791:(e,t,r)=>{r.d(t,{R:()=>h});var s=r(13785),o=r(26773),a=r(9133);let n=a.z.object({content:a.z.array(a.z.object({type:a.z.string(),text:a.z.string()})),isError:a.z.boolean().optional()}),i=a.z.object({stories:a.z.array(a.z.any()),total:a.z.number(),hasMore:a.z.boolean().optional(),offset:a.z.number().optional(),limit:a.z.number().optional()}),c=a.z.any(),l=a.z.object({stories:a.z.array(a.z.any()),total:a.z.number(),query:a.z.string(),searchFields:a.z.array(a.z.string())}),u=a.z.object({totalStories:a.z.number(),publishedStories:a.z.number(),draftStories:a.z.number(),storiesByType:a.z.record(a.z.number()),storiesByTag:a.z.record(a.z.number()),storiesByAuthor:a.z.record(a.z.number()),storiesByOrganization:a.z.record(a.z.number()),insights:a.z.any().optional(),lastUpdated:a.z.string()});class p{constructor(){this.connected=!1,this.client=new s.K({name:"justicehub-api",version:"1.0.0"},{capabilities:{}}),this.transport=new o.yW({command:"node",args:["/app/airtable-mcp-server/dist/index.js"],env:{...process.env,NODE_ENV:"production"}})}async connect(){if(!this.connected)try{await this.client.connect(this.transport),this.connected=!0}catch(e){throw Error("MCP server connection failed")}}async disconnect(){this.connected&&(await this.client.close(),this.connected=!1)}async callTool(e,t){this.connected||await this.connect();try{let r=await this.client.callTool({name:e,arguments:t}),s=n.parse(r);if(s.isError)throw Error(s.content[0]?.text||"Unknown MCP error");return JSON.parse(s.content[0]?.text||"{}")}catch(e){throw e}}async getStories(e){let t=await this.callTool("get_stories",e);return i.parse(t)}async getStoryById(e,t=!0){let r=await this.callTool("get_story_by_id",{recordId:e,includeMedia:t});return c.parse(r)}async searchStories(e,t,r){let s=await this.callTool("search_stories",{query:e,searchFields:t,limit:r});return l.parse(s)}async getStoriesByTag(e,t=!1,r){return await this.callTool("get_stories_by_tag",{tags:e,matchAll:t,limit:r})}async getStoryMetadata(e){let t=await this.callTool("get_story_metadata",{organizationId:e});return u.parse(t)}async getResource(e){this.connected||await this.connect();try{let t=await this.client.getResource({uri:e});if(!t.contents?.[0])throw Error("No content returned from resource");return JSON.parse(t.contents[0].text||"{}")}catch(e){throw e}}}let d=null;function h(){return d||(d=new p),d}"undefined"!=typeof process&&process.on("exit",async()=>{d&&await d.disconnect()})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,2707,4099,6530],()=>r(25047));module.exports=s})();