"use strict";(()=>{var e={};e.id=9123,e.ids=[9123],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},17718:e=>{e.exports=require("node:child_process")},97742:e=>{e.exports=require("node:process")},22037:e=>{e.exports=require("os")},63477:e=>{e.exports=require("querystring")},76224:e=>{e.exports=require("tty")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},66679:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>E,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>m,staticGenerationAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{GET:()=>d});var o=r(49303),n=r(88716),a=r(60670),i=r(87070),c=r(79396),l=r(67791),u=r(9133);let p=u.z.object({tags:u.z.string().transform(e=>e.split(",")),matchAll:u.z.string().transform(e=>"true"===e).optional(),limit:u.z.string().regex(/^\d+$/).transform(Number).optional()});async function d(e){try{let t=await (0,c.Gg)();if(!t?.user)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=Object.fromEntries(e.nextUrl.searchParams);if(!r.tags)return i.NextResponse.json({error:"Tags parameter is required"},{status:400});let s=p.parse(r),o=(0,l.R)(),n=await o.getStoriesByTag(s.tags,s.matchAll||!1,s.limit),a=i.NextResponse.json(n);return a.headers.set("Cache-Control","public, s-maxage=300, stale-while-revalidate=600"),a}catch(e){if(e instanceof u.z.ZodError)return i.NextResponse.json({error:"Invalid query parameters",details:e.errors},{status:400});return i.NextResponse.json({error:"Failed to fetch stories by tags"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/airtable/stories/tags/route",pathname:"/api/airtable/stories/tags",filename:"route",bundlePath:"app/api/airtable/stories/tags/route"},resolvedPagePath:"/Users/benknight/Code/JusticeHub/src/app/api/airtable/stories/tags/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:m}=h,x="/api/airtable/stories/tags/route";function E(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:y})}},79396:(e,t,r)=>{r.d(t,{Gg:()=>p});var s=r(64099);if(!process.env.AUTH0_SECRET)throw Error("AUTH0_SECRET is not defined");if(!process.env.AUTH0_BASE_URL)throw Error("AUTH0_BASE_URL is not defined");if(!process.env.AUTH0_ISSUER_BASE_URL)throw Error("AUTH0_ISSUER_BASE_URL is not defined");if(!process.env.AUTH0_CLIENT_ID)throw Error("AUTH0_CLIENT_ID is not defined");if(!process.env.AUTH0_CLIENT_SECRET)throw Error("AUTH0_CLIENT_SECRET is not defined");let{handleAuth:o,handleLogin:n,handleLogout:a,handleCallback:i,handleProfile:c,withApiAuthRequired:l,withPageAuthRequired:u,getSession:p,getAccessToken:d,updateSession:h}=(0,s.initAuth0)({baseURL:process.env.AUTH0_BASE_URL,issuerBaseURL:process.env.AUTH0_ISSUER_BASE_URL,clientID:process.env.AUTH0_CLIENT_ID,clientSecret:process.env.AUTH0_CLIENT_SECRET,secret:process.env.AUTH0_SECRET,authorizationParams:{scope:process.env.AUTH0_SCOPE||"openid profile email",audience:process.env.AUTH0_AUDIENCE},routes:{callback:"/api/auth/callback",postLogoutRedirect:"/"},session:{rollingDuration:28800,absoluteDuration:604800}})},67791:(e,t,r)=>{r.d(t,{R:()=>h});var s=r(13785),o=r(26773),n=r(9133);let a=n.z.object({content:n.z.array(n.z.object({type:n.z.string(),text:n.z.string()})),isError:n.z.boolean().optional()}),i=n.z.object({stories:n.z.array(n.z.any()),total:n.z.number(),hasMore:n.z.boolean().optional(),offset:n.z.number().optional(),limit:n.z.number().optional()}),c=n.z.any(),l=n.z.object({stories:n.z.array(n.z.any()),total:n.z.number(),query:n.z.string(),searchFields:n.z.array(n.z.string())}),u=n.z.object({totalStories:n.z.number(),publishedStories:n.z.number(),draftStories:n.z.number(),storiesByType:n.z.record(n.z.number()),storiesByTag:n.z.record(n.z.number()),storiesByAuthor:n.z.record(n.z.number()),storiesByOrganization:n.z.record(n.z.number()),insights:n.z.any().optional(),lastUpdated:n.z.string()});class p{constructor(){this.connected=!1,this.client=new s.K({name:"justicehub-api",version:"1.0.0"},{capabilities:{}}),this.transport=new o.yW({command:"node",args:["/app/airtable-mcp-server/dist/index.js"],env:{...process.env,NODE_ENV:"production"}})}async connect(){if(!this.connected)try{await this.client.connect(this.transport),this.connected=!0}catch(e){throw Error("MCP server connection failed")}}async disconnect(){this.connected&&(await this.client.close(),this.connected=!1)}async callTool(e,t){this.connected||await this.connect();try{let r=await this.client.callTool({name:e,arguments:t}),s=a.parse(r);if(s.isError)throw Error(s.content[0]?.text||"Unknown MCP error");return JSON.parse(s.content[0]?.text||"{}")}catch(e){throw e}}async getStories(e){let t=await this.callTool("get_stories",e);return i.parse(t)}async getStoryById(e,t=!0){let r=await this.callTool("get_story_by_id",{recordId:e,includeMedia:t});return c.parse(r)}async searchStories(e,t,r){let s=await this.callTool("search_stories",{query:e,searchFields:t,limit:r});return l.parse(s)}async getStoriesByTag(e,t=!1,r){return await this.callTool("get_stories_by_tag",{tags:e,matchAll:t,limit:r})}async getStoryMetadata(e){let t=await this.callTool("get_story_metadata",{organizationId:e});return u.parse(t)}async getResource(e){this.connected||await this.connect();try{let t=await this.client.getResource({uri:e});if(!t.contents?.[0])throw Error("No content returned from resource");return JSON.parse(t.contents[0].text||"{}")}catch(e){throw e}}}let d=null;function h(){return d||(d=new p),d}"undefined"!=typeof process&&process.on("exit",async()=>{d&&await d.disconnect()})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,2707,4099,6530],()=>r(66679));module.exports=s})();