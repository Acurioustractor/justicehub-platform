(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{2073:function(r,e,t){Promise.resolve().then(t.bind(t,6853)),Promise.resolve().then(t.t.bind(t,4671,23)),Promise.resolve().then(t.t.bind(t,3054,23)),Promise.resolve().then(t.bind(t,8601))},8601:function(r,e,t){"use strict";t.d(e,{Providers:function(){return ro}});var i=t(7437),o=t(1444),n=t(6094),a=t(3191),l=t(6853),s=t(2265),u=t(6862);let d=(0,u.oM)({name:"auth",initialState:{user:null,isAuthenticated:!1,isLoading:!1,error:null},reducers:{loginStart:r=>{r.isLoading=!0,r.error=null},loginSuccess:(r,e)=>{r.isLoading=!1,r.isAuthenticated=!0,r.user=e.payload,r.error=null},loginFailure:(r,e)=>{r.isLoading=!1,r.isAuthenticated=!1,r.user=null,r.error=e.payload},logout:r=>{r.isAuthenticated=!1,r.user=null,r.error=null},clearError:r=>{r.error=null},updateUser:(r,e)=>{r.user&&(r.user={...r.user,...e.payload})}}}),{loginStart:c,loginSuccess:p,loginFailure:y,logout:f,clearError:g,updateUser:h}=d.actions;var m=d.reducer;let v=(0,u.oM)({name:"user",initialState:{currentUser:null,youthProfile:null,isLoading:!1,error:null,profileCompletion:0},reducers:{setUser:(r,e)=>{r.currentUser=e.payload,r.youthProfile=e.payload.youthProfile||null,r.profileCompletion=S(e.payload)},updateProfile:(r,e)=>{r.currentUser&&(r.currentUser={...r.currentUser,...e.payload},r.profileCompletion=S(r.currentUser))},updateYouthProfile:(r,e)=>{r.youthProfile&&(r.youthProfile={...r.youthProfile,...e.payload})},setLoading:(r,e)=>{r.isLoading=e.payload},setError:(r,e)=>{r.error=e.payload},clearUser:r=>{r.currentUser=null,r.youthProfile=null,r.profileCompletion=0,r.error=null}}});function S(r){let e=[r.profile.firstName,r.profile.lastName,r.email,r.profile.dateOfBirth,r.profile.phone];return Math.round(e.filter(r=>r&&""!==r.toString().trim()).length/e.length*100)}let{setUser:z,updateProfile:O,updateYouthProfile:b,setLoading:P,setError:E,clearUser:L}=v.actions;var C=v.reducer;let U=(0,u.oM)({name:"stories",initialState:{stories:[],currentStory:null,isLoading:!1,error:null,filters:{storyType:null,visibility:null,tags:[],searchQuery:""},pagination:{page:1,limit:10,total:0,hasMore:!1}},reducers:{setStories:(r,e)=>{r.stories=e.payload},addStory:(r,e)=>{r.stories.unshift(e.payload)},updateStory:(r,e)=>{var t;let i=r.stories.findIndex(r=>r.id===e.payload.id);-1!==i&&(r.stories[i]=e.payload),(null===(t=r.currentStory)||void 0===t?void 0:t.id)===e.payload.id&&(r.currentStory=e.payload)},deleteStory:(r,e)=>{var t;r.stories=r.stories.filter(r=>r.id!==e.payload),(null===(t=r.currentStory)||void 0===t?void 0:t.id)===e.payload&&(r.currentStory=null)},setCurrentStory:(r,e)=>{r.currentStory=e.payload},setLoading:(r,e)=>{r.isLoading=e.payload},setError:(r,e)=>{r.error=e.payload},setFilters:(r,e)=>{r.filters={...r.filters,...e.payload}},clearFilters:r=>{r.filters={storyType:null,visibility:null,tags:[],searchQuery:""}},setPagination:(r,e)=>{r.pagination={...r.pagination,...e.payload}},appendStories:(r,e)=>{r.stories=[...r.stories,...e.payload]}}}),{setStories:w,addStory:x,updateStory:M,deleteStory:T,setCurrentStory:j,setLoading:k,setError:A,setFilters:F,clearFilters:_,setPagination:N,appendStories:R}=U.actions;var I=U.reducer;let q=(0,u.oM)({name:"organization",initialState:{currentOrganization:null,organizations:[],isLoading:!1,error:null,members:[],settings:{notifications:!0,publicProfile:!0,allowMentorRequests:!0}},reducers:{setCurrentOrganization:(r,e)=>{r.currentOrganization=e.payload},setOrganizations:(r,e)=>{r.organizations=e.payload},updateOrganization:(r,e)=>{r.currentOrganization&&(r.currentOrganization={...r.currentOrganization,...e.payload});let t=r.organizations.findIndex(e=>{var t;return e.id===(null===(t=r.currentOrganization)||void 0===t?void 0:t.id)});-1!==t&&r.currentOrganization&&(r.organizations[t]=r.currentOrganization)},addOrganization:(r,e)=>{r.organizations.push(e.payload)},removeOrganization:(r,e)=>{var t;r.organizations=r.organizations.filter(r=>r.id!==e.payload),(null===(t=r.currentOrganization)||void 0===t?void 0:t.id)===e.payload&&(r.currentOrganization=null)},setMembers:(r,e)=>{r.members=e.payload},addMember:(r,e)=>{r.members.push(e.payload)},removeMember:(r,e)=>{r.members=r.members.filter(r=>r.id!==e.payload)},setLoading:(r,e)=>{r.isLoading=e.payload},setError:(r,e)=>{r.error=e.payload},updateSettings:(r,e)=>{r.settings={...r.settings,...e.payload}},clearOrganization:r=>{r.currentOrganization=null,r.members=[],r.error=null}}}),{setCurrentOrganization:D,setOrganizations:H,updateOrganization:Q,addOrganization:Y,removeOrganization:B,setMembers:W,addMember:G,removeMember:J,setLoading:K,setError:V,updateSettings:X,clearOrganization:Z}=q.actions;var $=q.reducer;let rr=(0,u.xC)({reducer:{auth:m,user:C,stories:I,organization:$},middleware:r=>r({serializableCheck:{ignoredActions:["persist/PERSIST","persist/REHYDRATE"]}}),devTools:!1});var re=t(9512);function rt(r){let{children:e,...t}=r;return(0,i.jsx)(re.f,{...t,children:e})}var ri=t(2727);function ro(r){let{children:e}=r,[t]=(0,s.useState)(()=>new n.S({defaultOptions:{queries:{staleTime:3e5,cacheTime:6e5,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:(r,e)=>(!((null==e?void 0:e.status)>=400)||!((null==e?void 0:e.status)<500))&&r<3,retryDelay:r=>Math.min(1e3*2**r,3e4)},mutations:{retry:(r,e)=>(!((null==e?void 0:e.status)>=400)||!((null==e?void 0:e.status)<500))&&r<2,onError:r=>{}}}}));return(0,i.jsx)(l.UserProvider,{children:(0,i.jsx)(o.zt,{store:rr,children:(0,i.jsx)(a.aH,{client:t,children:(0,i.jsx)(ri.dr,{children:(0,i.jsx)(rt,{attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!0,children:e})})})})})}},2727:function(r,e,t){"use strict";t.d(e,{SE:function(){return s},dr:function(){return l}});var i=t(7437),o=t(2265),n=t(6853);let a=(0,o.createContext)(void 0);function l(r){var e;let{children:t}=r,{user:l,error:s,isLoading:u}=(0,n.aF)(),[d,c]=(0,o.useState)(null),[p,y]=(0,o.useState)(!0),[f,g]=(0,o.useState)(null),h=async()=>{if(!l){c(null),y(!1);return}try{let r=await fetch("/api/users/profile");if(!r.ok)throw Error("Failed to fetch user profile");let e=await r.json();c(e)}catch(r){g(r instanceof Error?r:Error("Unknown error"))}finally{y(!1)}};(0,o.useEffect)(()=>{u||h()},[l,u,!1]),!d||(null===(e=d.profile)||void 0===e?void 0:e.name)&&d.role&&d.role;let m=async()=>{y(!0),await h()},v=(null==d?void 0:d.role)||"youth";return(0,i.jsx)(a.Provider,{value:{user:d,isLoading:p||u,error:f||s,role:v,refreshUser:m},children:t})}function s(){let r=(0,o.useContext)(a);if(void 0===r)throw Error("useUserContext must be used within a UserProvider");return r}},3054:function(){}},function(r){r.O(0,[3959,9141,6853,1336,2995,2971,7023,1744],function(){return r(r.s=2073)}),_N_E=r.O()}]);